(function($) {
  "use strict";
  return $(function() {
		$(document).foundation();
		// Smooth scroll offset due to sticky nav covering page content.
		// If url is a valid hash for this page then scroll to it on page load.
		var hash = document.location.hash;
		if ( $(hash).length > 0 ) {
			Foundation.SmoothScroll.scrollToLoc(hash, {
				offset: $('.site-header').height(),
				animationDuration: 500,
				animationEasing: 'linear',
				threshold: 50
			});
		}
		// Reset scroll links.
		$(window).on('hashchange', function(e){
			var hash = document.location.hash;
			Foundation.SmoothScroll.scrollToLoc(hash, {
				offset: $('.site-header').height(),
				animationDuration: 500,
				animationEasing: 'linear',
				threshold: 50
			});
		});

		if ( $('.modal iframe').length > 0 && $('.modal iframe').attr('src') && $('.modal iframe').attr('src').indexOf('autoplay=1') >= 0 ) {
			var url = $('.modal iframe').attr('src');
			$('.modal iframe').attr('data-af4-autoplay', '1').attr( 'src', url.replace( '&autoplay=1', '' ) ).attr( 'allow', function() {
				var allow = $( this ).attr('allow');
				return allow.replace(/(^\s)?autoplay;?\s?/, '').replace(/;?\s?$/, '');
			});
		}

		$('.modal').on('off.zf.toggler', function(e){
			// Fade in.
			var $iframe = $(this).find('iframe');
			if ( $iframe.attr('data-af4-autoplay') === '1' ) {
				var url = $iframe.attr('src');
				$iframe.attr( 'src', url + '&autoplay=1' ).attr( 'allow', $iframe.attr( 'allow' ) + '; autoplay' );
			}
			$(this).fadeIn(1000);
		});

		$('.modal').on('on.zf.toggler', function(e){
			// Fade out.
			var $iframe = $(this).find('iframe');
			var callback = null;
			if ( $iframe.attr('data-af4-autoplay') === '1' ) {
				var url = $iframe.attr('src');
				callback = function(){
					$iframe.attr( 'src', url.replace('&autoplay=1','') ).attr( 'allow', function() {
						var allow = $( this ).attr('allow');
						return allow.replace(/(^\s)?autoplay;?\s?/, '').replace(/;?\s?$/, '');
					} );
				};
			}
			$(this).fadeOut(1000, callback);
		});
		return;
  });
})(jQuery);
